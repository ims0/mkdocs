## 七，[MySQL 索引](https://www.cnblogs.com/wangsen/p/10864136.html)

MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。

创建索引时，你需要确保该**索引是应用在 SQL 查询语句的条件**(一般作为 WHERE 子句的条件)。

上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。

### 怎样提高查询性能

简单的理解：一张数据量比较大的表格如果没有添加任何索引，那我们在执行查询的时候
就会是进行全表扫描，逐行比对，这样的读取效率肯定很低，如果我们为数据创建了索引
索引的实现方式又是支持快速查询的这样我们只需要先查询索引中符合条件的，
然后再通过索引指向的数据行位置就可以实现快速定位数据了，不用全表扫描了。

### 索引存储位置

数据库索引是存储在磁盘上，当表中的数据量比较大时，索引的大小也跟着增长，达到几个G甚至更多。
当我们利用索引进行查询的时候，不可能把索引全部加载到内存中，只能加载一部分其他的都要从磁盘中读取后加载到内存。

### 索引分类

+ 主键索引
一个列为设置为主键会默认创建一个主键索引。
主键索引是唯一索引的特定类型。该索引要求主键中的每个值都唯一。当创建或更改表时可通过定义 `PRIMARY KEY` 约束来创建主键。一个表只能有一个主键列，且该列不能接受空值。 由于 PRIMARY KEY 约束确保唯一数据，所以经常用来定义标识列.

+ 唯一索引
严格来说主键索引是唯一索引的一种，这两个的区别是：主键索引不允许为null，唯一索引可以为null;
+ 单列索引
即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引。
+ 复合索引
即一个索引包含多个列。

###聚集索引和非聚集索引

#### 聚集索引

数据行的物理顺序与列值（一般是主键的那一列）的逻辑顺序相同，一个表中只能拥有一个聚集索引。
聚集索引的叶子节点存放有对应的数据节点，可以直接获取到对应的数据，
如果不创建索引，系统会自动创建一个隐含列作为表的聚集索引。
最好还是在创建表的时候添加聚集索引
在经常用于查询或聚合条件的字段上建立聚集索引。这类查询条件包括 between, >, <,group by, max,min, count等。

#### 非聚集索引

**叶子节点存放的不是实际数据，而是指向实际数据的指针。**
数据行的物理顺序与列值的逻辑顺序不相同，一个表中可以拥有多个非聚集索引。
聚集索引以外的索引都是非聚集索引,细分可以分为：普通索引，唯一索引，全文索引

### MyISAM和InnoDB的B+Tree实现

索引是数据库引擎去实现的，在建立表的时候都会指定，数据库引擎是一种插拔式的，根据自己的选择去决定使用那个

### MyISAM索引实现（非聚集）

MYISAM中叶子节点的数据区域存储的是**数据记录的地址**。
MyISAM中的主键索引和辅助引是没有区别的，其叶子节点存放的都是数据记录的地址。


![avatar](dataStruct_pic/myISAM.png)

#### InnoDB的索引实现（聚集）

InnoDB中的叶子节点数据区域存储的内容和主键索引和辅助索引是有区别的：

主键索引存储的就是索引+数据（index+data）

![avatar](dataStruct_pic/innoDB.png)
Innodb的主键索引要比MyISAM的主键索引查询效率要高，因为找到主键索引就找到了数据,MyISAM还有通过地址查询一次。

辅助索引存储的是主键的值

![avatar](dataStruct_pic/innoDB2.png)
因此可以看出InnoDB的辅助索引会发生两次，一次通过辅助索引查询主键索引，一次是通过主键索引查询到数据。



### 主键、外键和索引的区别？

#### 定义：

 主键–唯一标识一条记录，不能有重复的，不允许为空

 外键–表的外键是另一表的主键, 外键可以有重复的, 可以是空值

 索引–该字段没有重复值，但可以有一个空值

#### 作用：

 主键–用来保证数据完整性

 外键–用来和其他表建立联系用的

 索引–是提高查询排序的速度

#### 个数：

 主键–主键只能有一个

 外键–一个表可以有多个外键

 索引–一个表可以有多个唯一索引

